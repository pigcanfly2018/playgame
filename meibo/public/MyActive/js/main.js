$('#canvas').css({'width':"100%"});function IsPC(){var userAgentInfo=navigator.userAgent;var Agents=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod");var flag=true;for(var v=0;v<Agents.length;v++){if(userAgentInfo.indexOf(Agents[v])>0){flag=false;break;}}return flag;}if(IsPC()){$('#canvas').css({'width':"100%",});}else{w_h=$(window).height();$('#canvas').css({'width':"100%",});canh=$("#canvas").height();$("#canvas").css({'margin-top':(w_h-canh)/2+'px',});$("body").css({"background":"url(images/bg.png)","background-size":"100% auto","background-position":"bottom center"});}var times=3;function init(){stage=new createjs.Stage("canvas");createjs.Touch.enable(stage);stage.enableMouseOver();w=stage.canvas.width;h=stage.canvas.height;shapeH=h;imgNormal=[{src:'bg.png',id:"bg"},{src:"Hammer.png",id:"Hammer"},{src:"hole.png",id:"hole"},{src:"hole2.png",id:"hole2"},{src:"mouse.png",id:"mouse"},{src:"mouseallss.png",id:"mouseall"},{src:"OverBg1.png",id:"OverBg1"},{src:"Btn.png",id:"Btn"},{src:"Sign2.png",id:"TimeBg"},];loader=new createjs.LoadQueue(false);loader.addEventListener("complete",ready);loader.loadManifest(imgNormal,true,'public/MyActive/images/');}function restart(){stage.removeAllChildren();stage.addChild(bg,ready);times=0;text2.text='还有'+times+'次机会';}function ready(){ready=new createjs.Container();bg=new createjs.Shape();bg.graphics.beginBitmapFill(loader.getResult("bg")).drawRect(0,0,w,1220);bg.x=0;bg.y=0;readyBtn=new createjs.Container();readybg=new createjs.Shape();readybg.graphics.beginBitmapFill(loader.getResult("Btn")).drawRect(0,0,140,60);readybg.regX=70;readybg.x=w>>1;readybg.y=240;readyBtn.cursor='pointer';text=new createjs.Text("开始游戏","24px Arial");text.color="#641e0a";text.textAlign='center';text.x=w>>1;text.y=readybg.y+18;readyBtn.addChild(readybg,text);text2=new createjs.Text("","18px Arial");text2.text='今天共有3次机会，祝亲有好运气哦 ^o^';text2.color="#fff";text2.textAlign='center';text2.x=w>>1;text2.y=readybg.y+70;readyBtn.addEventListener("click",readyGame);ready.addChild(readyBtn,text2);stage.addChild(bg,ready);createjs.Ticker.timingMode=createjs.Ticker.RAF;createjs.Ticker.addEventListener("tick",tick);}function tick(event){stage.update(event);}function readyGame(){if(times==0){}else{stage.removeChild(ready);stage.cursor='none';ExitBtn=new createjs.Container();exitbg=new createjs.Shape();exitbg.graphics.beginBitmapFill(loader.getResult("Btn")).drawRect(0,0,140,60);exittext=new createjs.Text("结束游戏","26px Arial");exittext.color="#641e0a";exittext.textAlign='center';exittext.x=140>>1;exittext.y=16;ExitBtn.addChild(exitbg,exittext);ExitBtn.scaleX=0.7;ExitBtn.scaleY=0.7;ExitBtn.x=550;ExitBtn.y=20;holeback1=new createjs.Container();mouseback=new createjs.Container();hole=new createjs.Bitmap(loader.getResult("hole"));hole2=new createjs.Bitmap(loader.getResult("hole2"));hole.regX=hole.image.width>>1;hole2.regX=hole2.image.width>>1;holearrr=[{x:100,y:340},{x:w*0.5,y:340},{x:w-100,y:340},{x:100,y:430},{x:w*0.5,y:430},{x:w-100,y:430},];mouseArr=[{x:100,y:255},{x:w*0.5,y:255},{x:w-100,y:255},{x:100,y:338},{x:w*0.5,y:338},{x:w-100,y:338},];mouseAll=[];addMouse(0);addMouse(1);addMouse(2);addMouse(3);addMouse(4);addMouse(5);Hammer=new createjs.Bitmap(loader.getResult("Hammer"));Hammer.regX=Hammer.image.width>>1;Hammer.regY=Hammer.image.height>>1;Hammer.scaleX=0.7;Hammer.scaleY=0.7;Hammer.x=0;Hammer.y=0;mouseshow=new Mouseshow();score=new Score();time=new Time();stage.addChild(holeback1,mouseback,score,ExitBtn,Hammer,mouseshow,time);stage.addEventListener("stagemousemove",handleMouseMove);stage.addEventListener("pressup",handleDown);}}function addMouse(num){var holethis=hole.clone();holethis.x=holearrr[num].x;holethis.y=holearrr[num].y;holeback1.addChild(holethis);var mouse=new Mouse();mb=new createjs.Shape();mb.regX=140>>1;mb.graphics.drawRect(0,0,140,170);mb.x=mouse.x=mouseArr[num].x;mb.y=mouse.y=mouseArr[num].y;mb.scaleX=mb.scaleY=0.7;mouseAll.push(mouse);mouse.mask=mb;var holethis2=hole2.clone();holethis2.x=holearrr[num].x;holethis2.y=holearrr[num].y+15;mouseback.addChild(mouse,holethis2);}function handleMouseMove(){Hammer.x=stage.mouseX;Hammer.y=stage.mouseY;if(Hammer.x>=ExitBtn.x&&Hammer.x<=ExitBtn.x+140&&Hammer.y>=ExitBtn.y&&Hammer.y<=ExitBtn.y+60){stage.cursor='pointer';}else{stage.cursor='none';}}function handleDown(evt){Hammer.x=evt.stageX;Hammer.y=evt.stageY;if(Hammer.x>=ExitBtn.x&&Hammer.x<=ExitBtn.x+140&&Hammer.y>=ExitBtn.y&&Hammer.y<=ExitBtn.y+60){gameOver();}else{if(score.num<=1){score.addNum(1);pd();gameOver();}else{score.addNum(1);pd();}}HammerGo=createjs.Tween.get(Hammer,{loop:false,override:true}).to({rotation:-20},100,createjs.linear).to({rotation:0},100,createjs.linear);}function pd(){for(i=0;i<mouseAll.length;i++){if(mouseAll[i].downbtn&&mouseArr[i].down&&Hammer.x>=mouseArr[i].x&&Hammer.x<=mouseArr[i].x+mouseAll[i].mouse.image.width&&Hammer.y>=mouseArr[i].y&&Hammer.y<=mouseArr[i].y+80&&mouseAll[i].mouseAnimate.y<=80){mouseAll[i].downbtn=false;mouseAll[i].mouseAnimate.gotoAndPlay('yun');if(mouseshow.movearr[i]){createjs.Tween.removeTweens(mouseshow.movearr[i]);}createjs.Tween.get(mouseAll[i].mouseAnimate,{loop:false,override:true}).to({y:0},0,createjs.linear).wait(300).to({y:200},2000,createjs.linear).call(overdown,[i]);score.addScore(1);}}}function gameOver(){stage.removeEventListener("pressup",handleDown);score.msg.text='游戏结束';mouseshow.removeEventListener("tick",mousedoTick);Hammer.x=0;Hammer.y=0;stage.removeEventListener("stagemousemove",handleMouseMove);stage.cursor="pointer";over=new createjs.Container();overbg=new createjs.Shape();overbg.graphics.beginBitmapFill(loader.getResult("OverBg1")).drawRect(0,0,496,380);overbg.x=0;overbg.y=0;overbg.alpha=1;overText1=new createjs.Text('本次游戏结束',"24px Arila");overText1.textAlign='center';overText1.x=496>>1;overText1.y=140;overText1.color="#641e0a";$.ajax({type:'post',url:'/ajax/doHit',data:{counttime:score.score},dataType:'text',beforeSend:beforeSend,success:function(msg){var data=eval("("+msg+")");if(data.failure){}else{overText1.text='本次游戏结束';overText1.text+=data.message;}},error:function(){}});stage.removeChild(time);exittext.text='返回首页';ExitBtn.regX=70;ExitBtn.x=496>>1;ExitBtn.y=300;ExitBtn.addEventListener("pressup",restart);over.addChild(overbg,overText1,ExitBtn);over.scaleX=over.scaleY=0;over.regX=496>>1;over.regY=348>>1;over.x=w>>1;;over.y=200;createjs.Tween.get(over,{loop:false,override:true}).to({scaleX:1,scaleY:1},600,createjs.Ease.bounceOut);stage.addChild(over);}function overdown(i){mouseAll[i].mouseAnimate.gotoAndStop('start');mouseArr[i].down=false;mouseAll[i].downbtn=true;}function mousedoTick(){mouseshow.mousedo();}function beforeSend(){overText1.text+="\n请稍等...";}